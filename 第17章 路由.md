# æ¦‚è¿°

[Vue Router >>](https://router.vuejs.org/zh/) æ˜¯ [Vue.js](https://cn.vuejs.org/) çš„å®˜æ–¹è·¯ç”±ï¼Œæ˜¯ [Vue.js](https://cn.vuejs.org/) çš„å®˜æ–¹è·¯ç”±ã€‚å®ƒä¸ Vue.js æ ¸å¿ƒæ·±åº¦é›†æˆï¼Œè®©ç”¨ Vue.js æ„å»ºå•é¡µåº”ç”¨å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚åŠŸèƒ½åŒ…æ‹¬ï¼š

- åµŒå¥—è·¯ç”±æ˜ å°„
- åŠ¨æ€è·¯ç”±é€‰æ‹©
- æ¨¡å—åŒ–ã€åŸºäºç»„ä»¶çš„è·¯ç”±é…ç½®
- è·¯ç”±å‚æ•°ã€æŸ¥è¯¢ã€é€šé…ç¬¦
- å±•ç¤ºç”± Vue.js çš„è¿‡æ¸¡ç³»ç»Ÿæä¾›çš„è¿‡æ¸¡æ•ˆæœ
- ç»†è‡´çš„å¯¼èˆªæ§åˆ¶
- è‡ªåŠ¨æ¿€æ´» CSS ç±»çš„é“¾æ¥
- HTML5 history æ¨¡å¼æˆ– hash æ¨¡å¼
- å¯å®šåˆ¶çš„æ»šåŠ¨è¡Œä¸º
- URL çš„æ­£ç¡®ç¼–ç 

# åˆæ¢

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªç¤ºä¾‹ï¼Œè®©å¤§å®¶äº†è§£è·¯ç”±çš„åŸºç¡€ä½¿ç”¨ï¼š

## æ„å»ºé¡¹ç›®

æ„å»ºæŒ‡ä»¤ï¼š

```shell
$ pnpm create vite router-examples --template vue-ts
$ cd router-examples && pnpm install
$ mkdir -p src/{routes,pages/{Home,News}} && touch src/{routes/index.ts,pages/{Home,News}/index.vue}
$ code .
```

ç›®å½•ç»“æ„ï¼š

```
router-examples
.
â”œâ”€â”€ public                   
â”œâ”€â”€ src                       
â”‚   â”œâ”€â”€ assets
â”‚   â”œâ”€â”€ components
â”‚   â”œâ”€â”€ pages                 # é¡µé¢ç»„ä»¶ï¼ˆä¸‹é¢åªåˆ—ä¸¾ä¸»è¦æ–‡ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ Home
â”‚   â”‚   â””â”€â”€ News              
â”‚   â”œâ”€â”€ routes                # è·¯ç”±é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ main.ts
â”‚	  â””â”€â”€	vite-env.d.ts                 
â”œâ”€â”€ index.html                
â”œâ”€â”€ ...            
â””â”€â”€ vite.config.js            
```

é…ç½®åˆ«åï¼š

```shell
$ pnpm add -D @types/node
```

> **`vite.config.ts`**

```ts
import type { UserConfig, ConfigEnv } from 'vite';
import { defineConfig } from 'vite'
import { resolve } from 'node:path';
import vue from '@vitejs/plugin-vue'

export default defineConfig(({ mode }: ConfigEnv): UserConfig => {
  void mode;
  const root = process.cwd();
  const pathResolve = (path: string) => resolve(root, '.', path);
  return {
    resolve: {
      alias: {
        "@": pathResolve('src'),
      },
    },
    plugins: [vue()],
  };
});
```

> **`tsconfig.app.json`**

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    },
  },
}
```

åœ¨é¡µé¢æ–‡ä»¶ä¸­ ***`pages/**/*.vue`*** ä¸­æ³¨å…¥å¦‚ä¸‹å†…å®¹ï¼š

```vue
<script setup lang="ts"></script>
<template>
  <p>This is XXX page.</p>
</template>
```

> **æç¤º**ï¼šè¯·å°† `XXX` æ›¿æ¢ä¸ºç›®å½•åã€‚

## å®‰è£…è·¯ç”±

```shell
$ pnpm add vue-router@4
```

## é…ç½®è·¯ç”±

> `src/routes/index.ts`

```typescript
import { createRouter, createWebHistory } from 'vue-router';
import type { RouteRecordRaw } from 'vue-router';


// â†’ å¼•å…¥ç»„ä»¶æ¨¡å—
import Home from '@/pages/Home/index.vue';

// â†’ å®šä¹‰è·¯ç”±
const routes: RouteRecordRaw[] = [
  { path: '/', redirect: '/home' /** é‡å®šå‘ */ },
  { path: '/home', component: Home },
  { path: '/news', component: () => import('../pages/News/index.vue') /** æ‡’åŠ è½½ç»„ä»¶æ¨¡å— */ },
];

// â†’ åˆ›å»ºè·¯ç”±
const router = createRouter({
  history: createWebHistory() /** åˆ›å»ºåŸºäºhistoryæ¨¡å¼çš„è·¯ç”± */,
  routes,
});

// â†’ å¯¼å‡ºè·¯ç”±
export default router;
```

## æ³¨å†Œè·¯ç”±

> `src/main.ts`

```typescript
import { createApp } from 'vue';
import router from '@/routes';
import App from '@/App.vue';

// â†’ åˆ›å»ºåº”ç”¨å®ä¾‹
const app = createApp(App);
// â†’ æ³¨å…¥è·¯ç”±
app.use(router);
// â†’ æŒ‚è½½
app.mount('#app');
```

## é…ç½®è·¯ç”±é“¾æ¥

> `src/App.vue`

```vue
<script setup lang="ts"></script>

<template>
  <!-- å¯¼èˆª -->
  <nav>
    <router-link to="/home">Home</router-link>
    <span> / </span>
    <router-link to="/news">News</router-link>
  </nav>
  <!-- è·¯ç”±è§†å›¾ -->
  <router-view></router-view>
</template>
```

## è¿è¡Œé¡¹ç›®ï¼ŒæŸ¥çœ‹æ•ˆæœ

```shell
$ pnpm dev
```

æ¼”ç¤ºæ•ˆæœï¼š

![](IMGS/router.gif)

> æ³¨æ„ï¼š
>
> 1. è·¯ç”±å®ä¾‹åˆ›å»ºåéœ€åœ¨vueå®ä¾‹ä¸­æ³¨å†Œè·¯ç”±ã€‚
> 2. é€šè¿‡ `<router-link>` å®ç°è·¯ç”±åŠ¨æ€åˆ‡æ¢ï¼Œæœ€ç»ˆä¼šè¢«æ¸²æŸ“æˆè¶…é“¾æ¥ã€‚
> 3. é€šè¿‡ `<router-view>` å‘ˆç°è·¯ç”±åˆ‡æ¢åæ˜¾ç¤ºçš„ç»„ä»¶å†…å®¹ã€‚

# åŸºç¡€ ?

## è·¯ç”±æ¨¡å¼

åœ¨åˆ›å»ºè·¯ç”±å®ä¾‹æ—¶ï¼Œæä¾›äº†2ç§è·¯ç”±æœ‰æ¨¡å¼ï¼š`hash` / `history`

| #        | å“ˆå¸Œæ¨¡å¼ï¼ˆ`Hash Mode`ï¼‰          | å†å²æ¨¡å¼ï¼ˆ`History Mode`ï¼‰                               |
| -------- | -------------------------------- | -------------------------------------------------------- |
| å‘ˆç°å½¢å¼ | http://localhost:3000/#/home     | http://localhost:3000/home                               |
| æ„é€ å‡½æ•° | `createWebHashHistory()`         | `createWebHistory()`                                     |
| å‘é€æœåŠ¡ | ä¸ä¼šå‘é€ç»™æœåŠ¡å™¨ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½® | éœ€è¦æœåŠ¡å™¨é…ç½®ä»¥æ”¯æŒåœ¨åˆ·æ–°é¡µé¢æ—¶æ­£ç¡®è¿”å›åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ |
| å›è½¦åˆ·æ–° | æ— å½±å“                           | 404ï¼Œéœ€é…ç½®é‡å®šå‘                                        |

## åŠ¨æ€è·¯ç”±

åŠ¨æ€è·¯ç”±è·¯å¾„å‚æ•°ä½¿ç”¨å†’å· `:` è¡¨ç¤ºï¼š

```ts
{ path: '/users/:id', component: () => import('../pages/User/index.vue') },
```

å½“ä¸€ä¸ªè·¯ç”±è¢«åŒ¹é…æ—¶ï¼Œå®ƒçš„ `params` çš„å€¼å°†åœ¨æ¯ä¸ªç»„ä»¶ä¸­ä»¥ `route.params` çš„å½¢å¼æš´éœ²å‡ºæ¥ã€‚

```vue
<template>
  <p>This is User page.</p>
  <p>IDï¼š{{ $route.params.id }}</p>
</template>
```

**æ³¨æ„**ï¼šä½¿ç”¨å¸¦æœ‰å‚æ•°çš„è·¯ç”±æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ç”¨æˆ·ä» `/users/1` å¯¼èˆªåˆ° `/users/2` æ—¶ï¼Œ**ç›¸åŒçš„ç»„ä»¶å®ä¾‹å°†è¢«é‡å¤ä½¿ç”¨**ã€‚å› ä¸ºä¸¤ä¸ªè·¯ç”±éƒ½æ¸²æŸ“åŒä¸ªç»„ä»¶ï¼Œæ¯”èµ·é”€æ¯å†åˆ›å»ºï¼Œå¤ç”¨åˆ™æ˜¾å¾—æ›´åŠ é«˜æ•ˆã€‚**ä¸è¿‡ï¼Œè¿™ä¹Ÿæ„å‘³ç€ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ä¼šè¢«è°ƒç”¨**ã€‚

è¦å¯¹åŒä¸€ä¸ªç»„ä»¶ä¸­å‚æ•°çš„å˜åŒ–åšå‡ºå“åº”çš„è¯ï¼Œä½ å¯ä»¥ç®€å•åœ° watch `$route` å¯¹è±¡ä¸Šçš„ä»»æ„å±æ€§ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå°±æ˜¯ `$route.params` ï¼š

```vue
<script setup lang="ts">
import { watch } from "vue";
import { useRoute } from "vue-router";

const route = useRoute();
watch(
  () => route.params.id,
  (newId, oldId) => {
    console.log(newId, oldId);
    // å¯¹è·¯ç”±å˜åŒ–åšå‡ºå“åº”...
  }
);
</script>

<template>
  <p>This is User page.</p>
  <p>IDï¼š{{ $route.params.id }}</p>
</template>
```

æˆ–è€…ï¼Œä½¿ç”¨ `beforeRouteUpdate` [å¯¼èˆªå®ˆå«](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html)ï¼Œå®ƒè¿˜å…è®¸ä½ å–æ¶ˆå¯¼èˆªï¼š

```vue
<script setup lang="ts">
import { onBeforeRouteUpdate } from "vue-router";

onBeforeRouteUpdate(async (to, from) => {
  // å¯¹è·¯ç”±å˜åŒ–åšå‡ºå“åº”...
  userData.value = await fetchUser(to.params.id);
});
</script>

<template>
  <p>This is User page.</p>
  <p>IDï¼š{{ $route.params.id }}</p>
</template>
```

> ğŸ“– **æ•è· 404 Not Found**

```js
{ path: '/:pathMatch(.*)*', name: 'NotFound', component: NotFound }
```

## è·¯ç”±åŒ¹é…

> **æç¤º**ï¼šä¸ºäº†ç®€å•èµ·è§ï¼Œæ‰€æœ‰çš„è·¯ç”±**éƒ½çœç•¥äº† `component` å±æ€§**ï¼Œåªå…³æ³¨ `path` å€¼ã€‚

### åœ¨å‚æ•°ä¸­è‡ªå®šä¹‰æ­£åˆ™

```js
const routes = [
  // ä»…åŒ¹é…æ•°å­—ï¼Œå¦‚ /123
  { path: '/:orderId(\\d+)' },
  // åŒ¹é…å…¶ä»–ä»»ä½•å†…å®¹ï¼Œå¦‚ /abc
  { path: '/:productName' },
]
```

> **æç¤º**ï¼šåœ¨ JavaScript ä¸­ï¼Œåæ–œæ  `\` éœ€è¦è½¬ä¹‰ä¸º `\\` ï¼Œæ¯”å¦‚ `\\d`ã€‚

### å¯é‡å¤çš„å‚æ•°

å¦‚æœéœ€è¦åŒ¹é…å¤šä¸ªéƒ¨åˆ†çš„è·¯ç”±ï¼Œæ¯”å¦‚ `/one/two/three` ï¼Œå¯ä»¥ä½¿ç”¨ `+` ï¼ˆ1 ä¸ªæˆ–å¤šä¸ªï¼‰æˆ– `*` ï¼ˆ0 ä¸ªæˆ–å¤šä¸ªï¼‰æ¥æ ‡è®°å‚æ•°ä¸ºå¯é‡å¤ï¼š

```js
const routes = [
  // åŒ¹é… /one, /one/two, /one/two/three ç­‰
  { path: '/:chapters+' },
  // åŒ¹é… /, /one, /one/two, /one/two/three ç­‰
  { path: '/:chapters*' },
]
```

ä½¿ç”¨å‘½åè·¯ç”±æ—¶ï¼Œéœ€è¦ä¼ é€’æ•°ç»„ï¼š

```js
// åŒ¹é… /a/b
router.resolve({ name: 'chapters', params: { chapters: ['a', 'b'] } }).href
```

> ğŸ“– **ç»“åˆè‡ªå®šä¹‰æ­£åˆ™å’Œå¯é‡å¤å‚æ•°**

```js
const routes = [
  // ä»…åŒ¹é…æ•°å­—ï¼Œå¦‚ /1, /1/2 ç­‰
  { path: '/:chapters(\\d+)+' },
  // åŒ¹é… /, /1, /1/2 ç­‰
  { path: '/:chapters(\\d+)*' },
]
```

### ä¸¥æ ¼å’Œå¤§å°å†™æ•æ„Ÿé…ç½®

é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯ç”±ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¹¶ä¸”å¯ä»¥åŒ¹é…å¸¦æˆ–ä¸å¸¦æ–œçº¿çš„è·¯å¾„ã€‚å¯ä»¥é€šè¿‡ `strict` å’Œ `sensitive` é€‰é¡¹ä¿®æ”¹ï¼š

```js
const router = createRouter({
  history: createWebHistory(),
  routes: [
    // ä»…åŒ¹é… /users/posvaï¼Œä¸åŒ¹é… /Users/posva æˆ– /users/posva/
    { path: '/users/:id', sensitive: true },
  ],
  strict: true, // å¯¹æ‰€æœ‰è·¯ç”±ç”Ÿæ•ˆ
})
```

### å¯é€‰å‚æ•°

ä½¿ç”¨ ? æ ‡è®°å‚æ•°ä¸ºå¯é€‰ï¼š

```js
const routes = [
  // åŒ¹é… /users å’Œ /users/123
  { path: '/users/:userId?' },
  // åŒ¹é… /users å’Œ /users/42
  { path: '/users/:userId(\\d+)?' },
]
```

> **æ³¨æ„**ï¼š`?` è¡¨ç¤ºå‚æ•°å¯é€‰ï¼Œä½†ä¸èƒ½é‡å¤ã€‚

## è·¯ç”±åµŒå¥— *

å½“åº”ç”¨ç¨‹åºçš„ UI ç”±å¤šå±‚åµŒå¥—çš„ç»„ä»¶ç»„æˆæ—¶ï¼ŒURL çš„ç‰‡æ®µé€šå¸¸å¯¹åº”äºç‰¹å®šçš„åµŒå¥—ç»„ä»¶ç»“æ„ã€‚ä¾‹å¦‚ï¼š

```
/user/johnny/profile                   /user/johnny/posts 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User             â”‚                  â”‚ User             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Profile      â”‚ â”‚  â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ â”‚ Posts        â”‚ â”‚
â”‚ â”‚              â”‚ â”‚                  â”‚ â”‚              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®åµŒå¥—è·¯ç”±

1. **é¡¶å±‚è·¯ç”±**

   ```js
   const routes = [{ path: '/user/:id', component: User }]
   ```

2. **åµŒå¥— \<router-view>**

   åœ¨ User ç»„ä»¶ä¸­æ·»åŠ  \<router-view> æ¥æ¸²æŸ“å­ç»„ä»¶ï¼š

   ```vue
   <!-- User.vue -->
   <template>
     <div class="user">
       <h2>User {{ $route.params.id }}</h2>
       <router-view />
     </div>
   </template>
   ```

3. **å­è·¯ç”±é…ç½® **

   ä½¿ç”¨ `children` é…ç½®å­è·¯ç”±ï¼š

   ```js
   const routes = [
     {
       path: '/user/:id',
       component: User,
       children: [
         { path: 'profile', component: UserProfile }, // /user/:id/profile
         { path: 'posts', component: UserPosts },     // /user/:id/posts
       ],
     },
   ]
   ```

4. **é»˜è®¤å­è·¯ç”±**

   å¦‚æœè®¿é—® `/user/:id` æ—¶ä¸åŒ¹é…ä»»ä½•å­è·¯ç”±ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé»˜è®¤ç»„ä»¶ï¼š

   ```js
   const routes = [
     {
       path: '/user/:id',
       component: User,
       children: [
         { path: '', component: UserHome }, // /user/:id
         // å…¶ä»–å­è·¯ç”±
       ],
     },
   ]
   ```

### å‘½åè·¯ç”±

1. **å­è·¯ç”±å‘½å**

   ```js
   const routes = [
     {
       path: '/user/:id',
       component: User,
       children: [{ path: '', name: 'user', component: UserHome }],
     },
   ]
   ```

2. **çˆ¶è·¯ç”±å‘½å**

   å¦‚æœä¸æƒ³é»˜è®¤æ˜¾ç¤ºå­è·¯ç”±ï¼Œå¯ä»¥å‘½åçˆ¶è·¯ç”±ï¼š

   ```js
   const routes = [
     {
       path: '/user/:id',
       name: 'user-parent',
       component: User,
       children: [{ path: '', name: 'user', component: UserHome }],
     },
   ]
   ```

### å¿½ç•¥çˆ¶ç»„ä»¶ï¼ˆ4.1+ï¼‰

å¦‚æœä¸éœ€è¦æ¸²æŸ“çˆ¶ç»„ä»¶ï¼Œå¯ä»¥çœç•¥ `component` é€‰é¡¹ï¼š

```js
const routes = [
  {
    path: '/admin',
    children: [
      { path: '', component: AdminOverview },
      { path: 'users', component: AdminUserList },
      { path: 'users/:id', component: AdminUserDetails },
    ], 
  },
]
```

è¿™æ ·ï¼Œé¡¶çº§ \<router-view> ä¼šç›´æ¥æ¸²æŸ“å­è·¯ç”±ç»„ä»¶ï¼Œè·³è¿‡çˆ¶ç»„ä»¶ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

- é…ç½®è·¯ç”±æ—¶é€šè¿‡æŒ‡å®š `children` å±æ€§æ¥é…ç½®å½“å‰è·¯ç”±çš„å­è·¯ç”±ã€‚
- å­è·¯ç”±å±äºè°ï¼Œ`<router-view />` å°±å†™åœ¨è°ä¸‹é¢ã€‚ *
- é»˜è®¤é‡å®šå‘ï¼Œä½¿ç”¨ `redirect` å±æ€§ã€‚
- å¦‚æœå­è·¯ç”±åœ¨ä¸»é¡µä¸­ï¼Œè®¾ç½® `path` å±æ€§æ—¶ï¼Œç›´æ¥ `/å­è·¯ç”±è·¯å¾„` å³å¯ã€‚

## å‘½åè·¯ç”±

åœ¨ Vue Router ä¸­ï¼Œå¯ä»¥ä¸ºè·¯ç”±è®¾ç½®ä¸€ä¸ª name ï¼Œæ–¹ä¾¿åœ¨å¯¼èˆªæ—¶ä½¿ç”¨åç§°è€Œéè·¯å¾„ã€‚

### å®šä¹‰å‘½åè·¯ç”±

```js
const routes = [
  {
    path: '/user/:username',
    name: 'profile', // è·¯ç”±åç§°
    component: User
  }
]
```

### ä½¿ç”¨å‘½åè·¯ç”±

åœ¨ \<router-link> ä¸­ä½¿ç”¨ name å¯¼èˆªï¼š

```vue
<router-link :to="{ name: 'profile', params: { username: 'erina' } }">
  User profile
</router-link>
```

ä¸Šè¿°ä»£ç ä¼šç”ŸæˆæŒ‡å‘ `/user/erina` çš„é“¾æ¥ã€‚

**ä¼˜ç‚¹**ï¼š

1. **é¿å…ç¡¬ç¼–ç  URL** ï¼šä½¿ç”¨åç§°ä»£æ›¿è·¯å¾„ï¼Œæ›´çµæ´»ã€‚
2. **è‡ªåŠ¨å¤„ç†å‚æ•°** ï¼š params ä¼šè‡ªåŠ¨ç¼–ç /è§£ç ã€‚
3. **é˜²æ­¢ URL é”™è¯¯** ï¼šå‡å°‘è·¯å¾„æ‹¼å†™é”™è¯¯ã€‚
4. **ç»•è¿‡è·¯å¾„æ’åº** ï¼šç›´æ¥åŒ¹é…æŒ‡å®šè·¯ç”±ï¼Œä¸å—è·¯å¾„é¡ºåºå½±å“ã€‚

> **âš ï¸ æ³¨æ„**ï¼šæ‰€æœ‰è·¯ç”±çš„ `name` å¿…é¡»å”¯ä¸€ã€‚å¦‚æœé‡å¤ï¼Œè·¯ç”±å™¨åªä¼šä¿ç•™æœ€åä¸€ä¸ªã€‚

**ç¼–ç¨‹å¼å¯¼èˆª**

åœ¨ `router.push()` æˆ– `router.replace()` ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ `name` ï¼š

```js
router.push({ name: 'profile', params: { username: 'erina' } })
```

å‘½åè·¯ç”±è®©å¯¼èˆªæ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤ï¼

## ç¼–ç¨‹å¼çš„å¯¼èˆª 

é™¤äº†ä½¿ç”¨ `<router-link>` åˆ›å»º a æ ‡ç­¾æ¥å®šä¹‰å¯¼èˆªé“¾æ¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© router çš„å®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡ç¼–å†™ä»£ç æ¥å®ç°ã€‚

### `router.push()` *

è¯­æ³•å¦‚ä¸‹ï¼š

```js
router.push(location, onComplete?, onAbort?)
```

> æ³¨æ„ï¼šåœ¨ Vue å®ä¾‹å†…éƒ¨çš„æ¨¡æ¿æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `$router` è®¿é—®è·¯ç”±å®ä¾‹ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```vue
<script setup lang="ts">
import { useRouter } from 'vue-router';

// â†’ è·å–routerå®ä¾‹
const router = useRouter();

// â†’ åœ¨äº‹ä»¶å‡½æ•°ä¸­è°ƒç”¨
const onGoNews = () => {
  router.push('/news');
};
</script>
<template>
  <p>This is Home page.</p>
  <button type="button" @click="onGoNews">Go News</button>
  <!-- ç›´æ¥åœ¨æ¨¡æ¿ä¸­è·å–routerå®ä¾‹ -->
  <button type="button" @click="$router.push('/news')">Go News</button>
</template>

```

æƒ³è¦å¯¼èˆªåˆ°ä¸åŒçš„ URLï¼Œå¯ä»¥ä½¿ç”¨ `router.push` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå‘ history æ ˆæ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•ï¼Œæ‰€ä»¥ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®æ—¶ï¼Œä¼šå›åˆ°ä¹‹å‰çš„ URLã€‚

å½“ä½ ç‚¹å‡» `<router-link>` æ—¶ï¼Œå†…éƒ¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç‚¹å‡» `<router-link :to="...">` ç›¸å½“äºè°ƒç”¨ `router.push(...)` ï¼š

| å£°æ˜å¼                    | ç¼–ç¨‹å¼             |
| ------------------------- | ------------------ |
| `<router-link :to="...">` | `router.push(...)` |

è¯¥æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è·¯å¾„ï¼Œæˆ–è€…ä¸€ä¸ªæè¿°åœ°å€çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

```js
// â†’ å­—ç¬¦ä¸²
router.push('/home')

// â†’ å¯¹è±¡
router.push({ path: '/home' })

// â†’ å‘½åçš„è·¯ç”±
router.push({ name: 'home', params: { id: '123' }})

// â†’ å¸¦æŸ¥è¯¢å‚æ•°ï¼Œå˜æˆ /register?plan=private
router.push({ path: '/register', query: { plan: 'private' }})
```

> **æ³¨æ„**ï¼šå¦‚æœæä¾›äº† `path`ï¼Œ`params` ä¼šè¢«å¿½ç•¥ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„ `query` å¹¶ä¸å±äºè¿™ç§æƒ…å†µã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä¸‹é¢ä¾‹å­çš„åšæ³•ï¼Œä½ éœ€è¦æä¾›è·¯ç”±çš„ `name` æˆ–æ‰‹å†™å®Œæ•´çš„å¸¦æœ‰å‚æ•°çš„ `path` ï¼š

```js
const username = 'muzili'
// â†’ æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å»ºç«‹ urlï¼Œä½†æˆ‘ä»¬å¿…é¡»è‡ªå·±å¤„ç†ç¼–ç 
router.push(`/user/${username}`) // â†’ /user/muzili
// â†’ åŒæ ·
router.push({ path: `/user/${username}` }) // â†’ /user/muzili
// â†’ å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨ name å’Œ params ä»è‡ªåŠ¨ URL ç¼–ç ä¸­è·ç›Š
router.push({ name: 'user', params: { username } }) // â†’ /user/muzili
// params ä¸èƒ½ä¸ path ä¸€èµ·ä½¿ç”¨
router.push({ path: '/user', params: { username } }) // â†’ /user
```

> **æç¤ºï¼š**åŒæ ·çš„è§„åˆ™ä¹Ÿé€‚ç”¨äº `<router-link\> ` ç»„ä»¶çš„ `to` å±æ€§ã€‚

### `router.replace()`

è¯­æ³•å¦‚ä¸‹ï¼š

```
router.replace(location, onComplete?, onAbort?)
```

è·Ÿ `router.push()` å¾ˆåƒï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯ï¼Œå®ƒä¸ä¼šå‘ history æ·»åŠ æ–°è®°å½•ï¼Œè€Œæ˜¯è·Ÿå®ƒçš„æ–¹æ³•åä¸€æ · â€”â€” æ›¿æ¢æ‰å½“å‰çš„ history è®°å½•ã€‚

| å£°æ˜å¼                            | ç¼–ç¨‹å¼                |
| --------------------------------- | --------------------- |
| `<router-link :to="..." replace>` | `router.replace(...)` |

ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¼ é€’ç»™ `router.push` çš„ `routeLocation` ä¸­å¢åŠ ä¸€ä¸ªå±æ€§ `replace: true` ï¼š

```typescript
router.push({ path: '/home', replace: true })
// ç›¸å½“äº
router.replace({ path: '/home' })
```

### `router.go()`

è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œæ„æ€æ˜¯åœ¨ history è®°å½•ä¸­å‘å‰æˆ–è€…åé€€å¤šå°‘æ­¥ï¼Œç±»ä¼¼ `window.history.go(n)`ã€‚

```js
//  â†’ å‘å‰ç§»åŠ¨ä¸€æ¡è®°å½•ï¼Œä¸ router.forward() ç›¸åŒ
router.go(1)

//  â†’ è¿”å›ä¸€æ¡è®°å½•ï¼Œä¸router.back() ç›¸åŒ
router.go(-1)

//  â†’ å‰è¿› 3 æ¡è®°å½•
router.go(3)

//  â†’ å¦‚æœæ²¡æœ‰é‚£ä¹ˆå¤šè®°å½•ï¼Œé™é»˜å¤±è´¥
router.go(-100)
router.go(100)
```

## å‘½åè§†å›¾

å¦‚æœéœ€è¦åŒæ—¶å±•ç¤ºå¤šä¸ªè§†å›¾ï¼ˆè€Œä¸æ˜¯åµŒå¥—å±•ç¤ºï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å‘½åè§†å›¾ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å« sidebar ï¼ˆä¾§å¯¼èˆªï¼‰å’Œ main ï¼ˆä¸»å†…å®¹ï¼‰çš„å¸ƒå±€ã€‚

> ğŸ“– **ä½¿ç”¨æ–¹æ³•**

```html
<router-view class="view left-sidebar" name="LeftSidebar" />
<router-view class="view main-content" />
<router-view class="view right-sidebar" name="RightSidebar" />
```

> ğŸ“– **é…ç½®ç»„ä»¶**

æ¯ä¸ªè§†å›¾éœ€è¦ä¸€ä¸ªç»„ä»¶æ¥æ¸²æŸ“ï¼Œå› æ­¤éœ€è¦åœ¨è·¯ç”±é…ç½®ä¸­ä½¿ç”¨ components ï¼ˆæ³¨æ„å¸¦ s ï¼‰ï¼š

```js
{
  path: '/',
  components: {
    default: Home, // é»˜è®¤è§†å›¾
    LeftSidebar,   // ä¸ <router-view name="LeftSidebar"> åŒ¹é…
    RightSidebar,  // ä¸ <router-view name="RightSidebar"> åŒ¹é…
  },
}
```

> ğŸ“– **è¯´æ˜**

1. å¦‚æœ \<router-view> æ²¡æœ‰è®¾ç½® name ï¼Œé»˜è®¤ä¸º default ã€‚
2. æ¯ä¸ªè§†å›¾å¯¹åº”ä¸€ä¸ªç»„ä»¶ï¼Œç¡®ä¿ components é…ç½®ä¸­çš„é”®ä¸ \<router-view> çš„ name åŒ¹é…ã€‚

## é‡å®šå‘å’Œåˆ«å

### é‡å®šå‘

é‡å®šå‘å¯ä»¥é€šè¿‡ routes é…ç½®å®ç°ï¼Œå°†ç”¨æˆ·ä»ä¸€ä¸ªè·¯å¾„å¯¼èˆªåˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚

1. **ç®€å•é‡å®šå‘ ï¼š**ä» /a é‡å®šå‘åˆ° /b 

   ```js
   { path: '/a', redirect: '/b' }
   ```

2. **å‘½åè·¯ç”±é‡å®šå‘**ï¼šé‡å®šå‘åˆ°ä¸€ä¸ªå‘½åçš„è·¯ç”±

   ```js
   { path: '/a', redirect: { name: 'foo' } }
   ```

3. **åŠ¨æ€é‡å®šå‘**ï¼šä½¿ç”¨å‡½æ•°åŠ¨æ€è¿”å›é‡å®šå‘ç›®æ ‡ï¼š

   ```js
   { path: '/a', redirect: to => {
     // æ¥æ”¶ç›®æ ‡è·¯ç”±ä½œä¸ºå‚æ•°
     // è¿”å›é‡å®šå‘çš„è·¯å¾„æˆ–è·¯å¾„å¯¹è±¡
     return { path: '/search', query: { q: to.params.searchText } }
   }}
   ```

> æ³¨æ„ï¼šå¯¼èˆªå®ˆå«åªä¼šåº”ç”¨åœ¨ç›®æ ‡è·¯ç”±ä¸Šï¼Œè€Œä¸æ˜¯è·³è½¬çš„è·¯ç”±ã€‚

### åˆ«å 

åˆ«åå…è®¸è®¿é—®ä¸€ä¸ªè·¯å¾„æ—¶ï¼ŒURL ä¿æŒä¸å˜ï¼Œä½†è·¯ç”±åŒ¹é…å¦ä¸€ä¸ªè·¯å¾„ã€‚

é…ç½®åˆ«åï¼šä¸º /a è®¾ç½®åˆ«å /b ï¼Œè®¿é—® /b æ—¶ï¼ŒURL ä¿æŒä¸º /b ï¼Œä½†è·¯ç”±åŒ¹é… /a 

```js
{ path: '/a', component: A, alias: '/b' }
```

åˆ«åçš„åŠŸèƒ½è®©ä½ å¯ä»¥çµæ´»åœ°å°† UI æ˜ å°„åˆ°ä»»æ„ URLï¼Œè€Œä¸å—åµŒå¥—è·¯ç”±ç»“æ„çš„é™åˆ¶ã€‚

## è·¯ç”±é«˜äº®æ•ˆæœ

åœ¨è·¯ç”±é“¾æ¥é€‰ä¸­æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ  `router-link-active` ç±»åï¼š

![](./IMGS/router-link-active.png)

ä½ å¯ä»¥åœ¨ `App.vue` ä¸­å…¨å±€è®¾ç½®é«˜äº®æ—¶çš„é¢œè‰²ï¼Œå¦‚ï¼š

```css
.router-link-active {
  color: blue;
}
```

## è·¯ç”±å‚æ•° *

è®¾ç½®è·¯ç”±è·³è½¬æ—¶ï¼Œå¯ä»¥è¿›è¡Œå‚æ•°ä¼ é€’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

### å‚æ•°ä»¥ `/` ä¼ é€’ï¼ˆ`path`ï¼‰

**@æŒ‡å®šä¼ é€’å‚æ•°ï¼š**

```javascript
{
  // â†’ åŠ¨æ€è·¯å¾„å‚æ•° ä»¥å†’å·å¼€å¤´
  // â†’ nameã€course ä¸ºä¼ é€’æ•°æ®
  path: '/news/:name/:course',
  name: 'news',
  component: News
}
```

**@è®¾ç½®ä¼ é€’æ•°æ®ï¼š**

```html
<!-- æ–¹æ³•1 ->
<router-link to="/news/muzili/web">News</router-link> 
<!-- æ–¹æ³•2 ->
<router-link :to="{name:'news', params:{name:'muzili', course:'web'}}">News</router-link>
```

**@è·å–ä¼ é€’æ•°æ®ï¼š**

```vue
<script setup lang="ts">
import { useRoute } from 'vue-router';
const route = useRoute();
// 1. è„šæœ¬ä¸­è®¿é—®
console.log(route.params); // â†’ {name: 'muzili', course: 'web'}
</script>

<template>
  <!-- 2. æ¨¡æ¿ä¸­è®¿é—® -->
  <p>{{ $route.params.name }} - {{ $route.params.course }}</p>
</template>
```

> æ³¨æ„ï¼šæ˜¯ `$route.params` è€Œä¸æ˜¯ `$router.params`ï¼Œåé¢ä¸è¦åŠ  `s`ã€‚

### å‚æ•°ä»¥ `?` ä¼ é€’ï¼ˆ`query`ï¼‰

æˆ‘ä»¬å¸¸è§çš„å‚æ•°ä¼ é€’æ˜¯é€šè¿‡ `location.search` ä¼ é€’çš„ï¼Œå³åœ¨ URI ä¸­å°†å‚æ•° ä»¥ `?` éš”å¼€è¿›è¡Œä¼ é€’ï¼Œvueä¸­è¦ä½¿ç”¨æ­¤æ–¹å¼ä¼ é€’è®¾ç½®å¦‚ä¸‹ï¼š

**@æŒ‡å®šå‚æ•°ä¼ é€’ï¼š**

ä½¿ç”¨queryä¼ å‚ï¼Œè·¯ç”±é…ç½®çš„æ—¶å€™pathä¸ç”¨å¸¦å‚æ•°

**@è®¾ç½®ä¼ é€’å‚æ•°ï¼š**

```vue
<router-link to="/news?name=muzili&course=web">News</router-link>
<router-link :to="{path:'/news', query:{name:'muzili', course:'web'">}}">News</router-link>
```

**@è·å–ä¼ é€’æ•°æ®ï¼š**

```vue
<script setup lang="ts">
import { useRoute } from 'vue-router';
const route = useRoute();
// 1. è„šæœ¬ä¸­è®¿é—®
console.log(route.query); // â†’ {name: 'muzili', course: 'web'}
</script>

<template>
  <!-- 2. æ¨¡æ¿ä¸­è®¿é—® -->
  <p>{{ $route.query.name }} - {{ $route.query.course }}</p>
</template>
```

### Path vs Query

| #           | ç±»å‹ | è·¯ç”±é…ç½®æ–‡ä»¶    | ä¼ é€’            | è®¿é—®                |
| ----------- | ---- | --------------- | --------------- | ------------------- |
| **`Path`**  | `/`  | `/path/:params` | `name` / params | `$route.params.xxx` |
| **`Query`** | `?`  | æ— éœ€ç‰¹æ®Šé…ç½®    | `path` / query  | `$route.query.x`xx  |

## `v-slot`

`<router-link>` é€šè¿‡ä¸€ä¸ªä½œç”¨åŸŸæ’æ§½æš´éœ²åº•å±‚çš„å®šåˆ¶èƒ½åŠ›ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´é«˜é˜¶çš„ APIï¼Œä¸»è¦é¢å‘åº“ä½œè€…ï¼Œä½†ä¹Ÿå¯ä»¥ä¸ºå¼€å‘è€…æä¾›ä¾¿åˆ©ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç”¨åœ¨ä¸€ä¸ªç±»ä¼¼ NavLink è¿™æ ·çš„ç»„ä»¶é‡Œã€‚

```vue
<router-link
  to="/about"
  custom
  v-slot="{ href, route, navigate, isActive, isExactActive }"
>
  <NavLink :active="isActive" :href="href" @click="navigate">
    {{ route.fullPath }}
  </NavLink>
</router-link>
```

- `href`ï¼šè§£æåçš„ URLã€‚å°†ä¼šä½œä¸ºä¸€ä¸ª `<a>` å…ƒç´ çš„ `href` å±æ€§ã€‚å¦‚æœä»€ä¹ˆéƒ½æ²¡æä¾›ï¼Œåˆ™å®ƒä¼šåŒ…å« `base`ã€‚
- `route`ï¼šè§£æåçš„è§„èŒƒåŒ–çš„åœ°å€ã€‚
- `navigate`ï¼šè§¦å‘å¯¼èˆªçš„å‡½æ•°ã€‚ **ä¼šåœ¨å¿…è¦æ—¶è‡ªåŠ¨é˜»æ­¢äº‹ä»¶**ï¼Œå’Œ `router-link` ä¸€æ ·ã€‚ä¾‹å¦‚ï¼š`ctrl` æˆ–è€… `cmd` + ç‚¹å‡»ä»ç„¶ä¼šè¢« `navigate` å¿½ç•¥ã€‚
- `isActive`ï¼šå¦‚æœéœ€è¦åº”ç”¨ [active class](https://next.router.vuejs.org/zh/api/#active-class)ï¼Œåˆ™ä¸º `true`ã€‚å…è®¸åº”ç”¨ä¸€ä¸ªä»»æ„çš„ classã€‚
- `isExactActive`ï¼šå¦‚æœéœ€è¦åº”ç”¨ [exact active class](https://next.router.vuejs.org/zh/api/#exact-active-class)ï¼Œåˆ™ä¸º `true`ã€‚å…è®¸åº”ç”¨ä¸€ä¸ªä»»æ„çš„ classã€‚

# è¿›é˜¶

## å¯¼èˆªå®ˆå« 

`å¯¼èˆª`ï¼šè¡¨ç¤ºè·¯ç”±æ­£åœ¨å‘ç”Ÿæ”¹å˜

`å®ˆå«`ï¼š é˜²å®ˆæŠ¤å«ï¼Œç±»ä¼¼äºå…³å¡ï¼Œå†³å®šæ˜¯å¦æ”¾è¡Œ

æ­£å¦‚å…¶åï¼Œvue-router æä¾›çš„å¯¼èˆªå®ˆå«ä¸»è¦ç”¨æ¥é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼å®ˆå«å¯¼èˆªã€‚è¿™é‡Œæœ‰å¾ˆå¤šæ–¹å¼æ¤å…¥è·¯ç”±å¯¼èˆªä¸­ï¼š`å…¨å±€çš„`ï¼Œ`å•ä¸ªè·¯ç”±ç‹¬äº«çš„`ï¼Œæˆ–è€… `ç»„ä»¶çº§` çš„ã€‚

**å®ˆå«å‚æ•°ï¼š**

æ¯ä¸ªå®ˆå«æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š

- `to`ï¼š å³å°†è¦è¿›å…¥çš„ [ç›®æ ‡è·¯ç”±å¯¹è±¡ >>](https://next.router.vuejs.org/zh/api/#routelocationnormalized)
- `from`ï¼šå½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„ [æºè·¯ç”±å¯¹è±¡ >>](https://next.router.vuejs.org/zh/api/#routelocationnormalized)

**è¿”å›å€¼ï¼š**

å„ä¸ªå®ˆå«å¯ä»¥è¿”å›çš„å€¼å¦‚ä¸‹ï¼š

- `false`ï¼š å–æ¶ˆå½“å‰çš„å¯¼èˆªï¼ˆä¸æ‰§è¡Œè·³è½¬ï¼‰
- `è·¯ç”±åœ°å€`ï¼šå¤šç”¨äºé‡å®šå‘ï¼Œæ¯”å¦‚åœ¨å®ˆå«ä¸­åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µ
- `undefine` / `true`ï¼šå¯¼èˆªæœ‰æ•ˆï¼Œæ”¾è¡Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ªå¯¼èˆªå®ˆå«ã€‚

### å…¨å±€å®ˆå«

**@å‰ç½®å®ˆå«**

å½“ä¸€ä¸ªå¯¼èˆªè§¦å‘æ—¶ï¼Œå…¨å±€å‰ç½®å®ˆå«æŒ‰ç…§åˆ›å»ºé¡ºåºè°ƒç”¨ã€‚å®ˆå«æ˜¯å¼‚æ­¥è§£ææ‰§è¡Œï¼Œæ­¤æ—¶å¯¼èˆªåœ¨æ‰€æœ‰å®ˆå« resolve å®Œä¹‹å‰ä¸€ç›´å¤„äº**ç­‰å¾…ä¸­**ã€‚

```js
// -- å‰ç½®å®ˆå«
router.beforeEach(async (to, from) => {
  console.log('__beforeEach__');
  // â†’ æ£€æµ‹ç™»å½•çŠ¶æ€
  if (to.path !== '/login' && !localStorage.getItem('loginStatus')) {
    return '/login';
  }
});
```

**@è§£æå®ˆå«**

å’Œå‰ç½®å®ˆå«ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯åœ¨å¯¼èˆªè¢«ç¡®è®¤ä¹‹å‰ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰ç»„ä»¶å†…å®ˆå«å’Œå¼‚æ­¥è·¯ç”±ç»„ä»¶è¢«è§£æä¹‹åï¼Œè§£æå®ˆå«å°±è¢«è°ƒç”¨ã€‚

```js
// -- è§£æå®ˆå«
router.beforeResolve(async (to, from) => {
  console.log('__beforeResolve__');
});
```

> æç¤ºï¼šè§£æå®ˆå«æ˜¯è·å–æ•°æ®æˆ–æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼ˆå¦‚æœç”¨æˆ·æ— æ³•è¿›å…¥é¡µé¢æ—¶ä½ å¸Œæœ›é¿å…æ‰§è¡Œçš„æ“ä½œï¼‰çš„ç†æƒ³ä½ç½®ã€‚

**@åç½®é’©å­**

ä½ ä¹Ÿå¯ä»¥æ³¨å†Œå…¨å±€åç½®é’©å­ï¼Œç„¶è€Œå’Œå®ˆå«ä¸åŒçš„æ˜¯ï¼Œè¿™äº›é’©å­ä¸ä¼šæ¥å— `next` å‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜å¯¼èˆªæœ¬èº«ï¼š

```js
// -- åç½®é’©å­
router.afterEach(async (to, from) => {
  console.log('__afterEach__');
  document.title = to.meta.title as string;
});
```

> æç¤ºï¼šåç½®é’©å­å¯¹äºåˆ†æã€æ›´æ”¹é¡µé¢æ ‡é¢˜ã€å£°æ˜é¡µé¢ç­‰è¾…åŠ©åŠŸèƒ½ä»¥åŠè®¸å¤šå…¶ä»–äº‹æƒ…éƒ½å¾ˆæœ‰ç”¨.

### è·¯ç”±ç‹¬äº«å®ˆå«

ä½ å¯ä»¥ç›´æ¥åœ¨è·¯ç”±é…ç½®ä¸Šå®šä¹‰ `beforeEnter` å®ˆå«ï¼š

```js
{
  path: '/home',
  component: Home,
  beforeEnter: (to, from) => {
    /** ... */
  },
},
```

### ç»„ä»¶å†…å®ˆå«

æœ€åï¼Œä½ å¯ä»¥åœ¨è·¯ç”±ç»„ä»¶å†…ç›´æ¥å®šä¹‰è·¯ç”±å¯¼èˆªå®ˆå«(ä¼ é€’ç»™è·¯ç”±é…ç½®çš„)

- `beforeRouteEnter`
- `beforeRouteUpdate
- `beforeRouteLeave`

```js
const UserDetails = {
  template: `...`,
  beforeRouteEnter(to, from) {
    // åœ¨æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢«éªŒè¯å‰è°ƒç”¨
    // ä¸èƒ½è·å–ç»„ä»¶å®ä¾‹ `this` ï¼
    // å› ä¸ºå½“å®ˆå«æ‰§è¡Œæ—¶ï¼Œç»„ä»¶å®ä¾‹è¿˜æ²¡è¢«åˆ›å»ºï¼
  },
  beforeRouteUpdate(to, from) {
    // åœ¨å½“å‰è·¯ç”±æ”¹å˜ï¼Œä½†æ˜¯è¯¥ç»„ä»¶è¢«å¤ç”¨æ—¶è°ƒç”¨
    // ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰åŠ¨æ€å‚æ•°çš„è·¯å¾„ `/users/:id`ï¼Œåœ¨ `/users/1` å’Œ `/users/2` ä¹‹é—´è·³è½¬çš„æ—¶å€™ï¼Œ
    // ç”±äºä¼šæ¸²æŸ“åŒæ ·çš„ `UserDetails` ç»„ä»¶ï¼Œå› æ­¤ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚è€Œè¿™ä¸ªé’©å­å°±ä¼šåœ¨è¿™ä¸ªæƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚
    // å› ä¸ºåœ¨è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ—¶å€™ï¼Œç»„ä»¶å·²ç»æŒ‚è½½å¥½äº†ï¼Œå¯¼èˆªå®ˆå«å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
  },
  beforeRouteLeave(to, from) {
    // åœ¨å¯¼èˆªç¦»å¼€æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨
    // ä¸ `beforeRouteUpdate` ä¸€æ ·ï¼Œå®ƒå¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
  },
};
```

`beforeRouteEnter` å®ˆå« **ä¸èƒ½** è®¿é—® `this`ï¼Œå› ä¸ºå®ˆå«åœ¨å¯¼èˆªç¡®è®¤å‰è¢«è°ƒç”¨ï¼Œå› æ­¤å³å°†ç™»åœºçš„æ–°ç»„ä»¶è¿˜æ²¡è¢«åˆ›å»ºã€‚

ä¸è¿‡ï¼Œä½ å¯ä»¥é€šè¿‡ä¼ ä¸€ä¸ªå›è°ƒç»™ `next` æ¥è®¿é—®ç»„ä»¶å®ä¾‹ã€‚åœ¨å¯¼èˆªè¢«ç¡®è®¤çš„æ—¶å€™æ‰§è¡Œå›è°ƒï¼Œå¹¶ä¸”æŠŠç»„ä»¶å®ä¾‹ä½œä¸ºå›è°ƒæ–¹æ³•çš„å‚æ•°ï¼š

```js
beforeRouteEnter (to, from, next) {
  next(vm => {
    // â†’ é€šè¿‡ vm è®¿é—®ç»„ä»¶å®ä¾‹
  })
}
```

æ³¨æ„ `beforeRouteEnter` æ˜¯æ”¯æŒç»™ `next` ä¼ é€’å›è°ƒçš„å”¯ä¸€å®ˆå«ã€‚å¯¹äº `beforeRouteUpdate` å’Œ `beforeRouteLeave` æ¥è¯´ï¼Œ`this` å·²ç»å¯ç”¨äº†ï¼Œæ‰€ä»¥ä¸æ”¯æŒä¼ é€’å›è°ƒï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦äº†ï¼š

```js
beforeRouteUpdate (to, from) {
  // just use `this`
  this.name = to.params.name
}
```

è¿™ä¸ª **ç¦»å¼€å®ˆå«** é€šå¸¸ç”¨æ¥é¢„é˜²ç”¨æˆ·åœ¨è¿˜æœªä¿å­˜ä¿®æ”¹å‰çªç„¶ç¦»å¼€ã€‚è¯¥å¯¼èˆªå¯ä»¥é€šè¿‡è¿”å› `false` æ¥å–æ¶ˆã€‚

```js
beforeRouteLeave (to, from) {
  const answer = window.confirm('Do you really want to leave? you have unsaved changes!')
  if (!answer) return false
}
```

> æç¤ºï¼šåœ¨çµ„åˆå¼API  `<script setup>` ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `onBeforeRouteUpdate` å’Œ `onBeforeRouteLeave` åˆ†åˆ«æ·»åŠ  `update` å’Œ `leave` å®ˆå«ã€‚ 

### å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹

- â†’ å¯¼èˆªè¢«è§¦å‘
- â†’ åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteLeave` å®ˆå«
- â†’ è°ƒç”¨å…¨å±€çš„ `beforeEach` å®ˆå«
- â†’ åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteUpdate` å®ˆå«(2.2+)
- â†’ åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ `beforeEnter`
- â†’ è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶
- â†’ åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouteEnter`
- â†’ è°ƒç”¨å…¨å±€çš„ `beforeResolve` å®ˆå«(2.5+)
- â†’ å¯¼èˆªè¢«ç¡®è®¤
- â†’ è°ƒç”¨å…¨å±€çš„ `afterEach` é’©å­
- â†’ è§¦å‘ DOM æ›´æ–°
- â†’ è°ƒç”¨ `beforeRouteEnter` å®ˆå«ä¸­ä¼ ç»™ `next` çš„å›è°ƒå‡½æ•°ï¼Œåˆ›å»ºå¥½çš„ç»„ä»¶å®ä¾‹ä¼šä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥

## è·¯ç”±å…ƒä¿¡æ¯ 

å®šä¹‰è·¯ç”±çš„æ—¶å€™å¯ä»¥é…ç½® `meta` å­—æ®µï¼Œç”¨äºæ·»åŠ å…³äºè·¯ç”±çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚é¡µé¢æ ‡é¢˜ï¼š

```js
{
  path: '/home',
  name: 'home',
  component: Home,
  meta: { title: 'é¦–é¡µ' },
}
```

é‚£ä¹ˆå¦‚ä½•è®¿é—®è¿™ä¸ª `meta` å­—æ®µå‘¢ï¼Ÿ

```js
// -- åç½®é’©å­
router.afterEach(async (to, from) => {
  console.log('__afterEach__');
  document.title = to.meta.title as string;
});
```

## è¿‡æ¸¡åŠ¨æ•ˆ 

æƒ³è¦åœ¨ä½ çš„è·¯å¾„ç»„ä»¶ä¸Šä½¿ç”¨è½¬åœºï¼Œå¹¶å¯¹å¯¼èˆªè¿›è¡ŒåŠ¨ç”»å¤„ç†ï¼Œä½ éœ€è¦ä½¿ç”¨ [v-slot API >>](https://next.router.vuejs.org/zh/api/#router-view-s-v-slot)

```html
<router-view v-slot="{ Component }">
  <transition
    enter-active-class="animate__animated animate__fadeInRight"
    leave-active-class="animate__animated animate__fadeOutLeft"
  >
    <component :is="Component" />
  </transition>
</router-view>
```

> **æç¤º**ï¼šä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ [animate.css >>](https://animate.style/) æ¥å®šä¹‰è¿‡æ¸¡æ•ˆæœã€‚

**ï¼å¼‚å¸¸å¤„ç†**

æç¤ºï¼š

```ini
Component inside <Transition> renders non-element root node that cannot be animated.
```

åŸå› ï¼šç”±äº `<Transition>` åªèƒ½åº”ç”¨åœ¨ **å•èŠ‚ç‚¹å…ƒç´ ** ä¸Šï¼Œè€Œæˆ‘ä»¬åœ¨æ„é€ ç»„ä»¶æ¨¡å—æ—¶ï¼Œç›´æ¥åœ¨ `<template>` ä¸­å†™å¸ƒå±€ï¼Œå¦‚ï¼š

```vue
<template>
  <p>This is Home page.</p>
  <p>Hello, vue.js!</p>
</template>
```

åœ¨æ¸²æŸ“ä¹‹åï¼Œå®é™…å‘ˆç°çš„ç»“æ„ä¸ºï¼š

```vue
<transition>
  <p>This is Home page.</p>
  <p>Hello, vue.js!</p>
</transition>
```

æ‰€ä»¥æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç»„ä»¶å¤–éƒ¨åŒ…è£¹ä¸€å±‚æ ‡ç­¾å³å¯ï¼Œå¦‚ï¼š

```vue
<template>
  <div class="page">
    <p>This is Home page.</p>
    <p>Hello, vue.js!</p>
  </div>
</template>
```

### å•ä¸ªè·¯ç”±çš„è¿‡æ¸¡

ä¸Šé¢çš„ç”¨æ³•ä¼šå¯¹æ‰€æœ‰çš„è·¯ç”±ä½¿ç”¨ç›¸åŒçš„è¿‡æ¸¡ã€‚å¦‚æœä½ æƒ³è®©æ¯ä¸ªè·¯ç”±çš„ç»„ä»¶æœ‰ä¸åŒçš„è¿‡æ¸¡ï¼Œä½ å¯ä»¥å°†å…ƒä¿¡æ¯å’ŒåŠ¨æ€çš„ name ç»“åˆåœ¨ä¸€èµ·ï¼Œæ”¾åœ¨ `<transition>` ä¸Šï¼š

```js
const routes = [
  {
    path: '/custom-transition',
    component: PanelLeft,
    meta: { transition: 'slide-left' },
  },
  {
    path: '/other-transition',
    component: PanelRight,
    meta: { transition: 'slide-right' },
  },
]
```

```html
<router-view v-slot="{ Component, route }">
  <!-- ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰è¿‡æ¸¡å’Œå›é€€åˆ° fade -->
  <transition :name="route.meta.transition || 'fade'">
    <component :is="Component" />
  </transition>
</router-view>
```

### åŸºäºè·¯ç”±çš„åŠ¨æ€è¿‡æ¸¡

è¿˜å¯ä»¥æ ¹æ®ç›®æ ‡è·¯ç”±å’Œå½“å‰è·¯ç”±ä¹‹é—´çš„å…³ç³»ï¼ŒåŠ¨æ€åœ°ç¡®å®šä½¿ç”¨çš„è¿‡æ¸¡ã€‚ä½¿ç”¨å’Œåˆšæ‰éå¸¸ç›¸ä¼¼çš„ç‰‡æ®µï¼š

```html
<!-- ä½¿ç”¨åŠ¨æ€è¿‡æ¸¡åç§° -->
<router-view v-slot="{ Component, route }">
  <transition :name="route.meta.transition">
    <component :is="Component" />
  </transition>
</router-view>
```
æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª **å¯¼èˆªåç½®é’©å­ï¼ˆ`afterEach`ï¼‰**ï¼Œæ ¹æ®è·¯å¾„çš„æ·±åº¦åŠ¨æ€æ·»åŠ ä¿¡æ¯åˆ°Â metaÂ å­—æ®µã€‚

```js
router.afterEach((to, from) => {
  const toDepth = to.path.split('/').length
  const fromDepth = from.path.split('/').length
  to.meta.transitionName = toDepth < fromDepth ? 'slide-right' : 'slide-left'
})
```

## æ•°æ®è·å–  *

æœ‰æ—¶å€™ï¼Œè¿›å…¥æŸä¸ªè·¯ç”±åï¼Œéœ€è¦ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¸²æŸ“ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä½ éœ€è¦ä»æœåŠ¡å™¨è·å–ç”¨æˆ·çš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼š

- **å¯¼èˆªå®Œæˆä¹‹åè·å–**ï¼šå…ˆå®Œæˆå¯¼èˆªï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­è·å–æ•°æ®ã€‚åœ¨æ•°æ®è·å–æœŸé—´æ˜¾ç¤º **åŠ è½½ä¸­...** ä¹‹ç±»çš„æŒ‡ç¤ºã€‚
- **å¯¼èˆªå®Œæˆä¹‹å‰è·å–**ï¼šå¯¼èˆªå®Œæˆå‰ï¼Œåœ¨è·¯ç”±è¿›å…¥çš„å®ˆå«ä¸­è·å–æ•°æ®ï¼Œåœ¨æ•°æ®è·å–æˆåŠŸåæ‰§è¡Œå¯¼èˆªã€‚

ä»æŠ€æœ¯è§’åº¦è®²ï¼Œä¸¤ç§æ–¹å¼éƒ½ä¸é”™ â€”â€” å°±çœ‹ä½ æƒ³è¦çš„ç”¨æˆ·ä½“éªŒæ˜¯å“ªç§ã€‚

**@å¯¼èˆªå®Œæˆä¹‹åè·å–**  

```js
created() {
  // â†’ æ˜¾ç¤ºåŠ è½½ä¸­ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
  // â†’ ajax
}
```

**@å¯¼èˆªå®Œæˆä¹‹å‰è·å–**

```js
beforeRouteEnter() {
  // => ajax
}
```

## æ»šåŠ¨è¡Œä¸º

ä½¿ç”¨å‰ç«¯è·¯ç”±ï¼Œå½“åˆ‡æ¢åˆ°æ–°è·¯ç”±æ—¶ï¼Œæƒ³è¦é¡µé¢æ»šåˆ°é¡¶éƒ¨ï¼Œæˆ–è€…æ˜¯ä¿æŒåŸå…ˆçš„æ»šåŠ¨ä½ç½®ï¼Œå°±åƒé‡æ–°åŠ è½½é¡µé¢é‚£æ ·ã€‚ vue-router èƒ½åšåˆ°ï¼Œè€Œä¸”æ›´å¥½ï¼Œå®ƒè®©ä½ å¯ä»¥è‡ªå®šä¹‰è·¯ç”±åˆ‡æ¢æ—¶é¡µé¢å¦‚ä½•æ»šåŠ¨ã€‚

> æ³¨æ„: è¿™ä¸ªåŠŸèƒ½åªåœ¨æ”¯æŒ `history.pushState` çš„æµè§ˆå™¨ä¸­å¯ç”¨ã€‚

å½“åˆ›å»ºä¸€ä¸ª Router å®ä¾‹ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ª `scrollBehavior` æ–¹æ³•ï¼š

```js
const router = createRouter({
  history: createWebHashHistory(),
  routes: [...],
  scrollBehavior (to, from, savedPosition) {
    // return æœŸæœ›æ»šåŠ¨åˆ°å“ªä¸ªçš„ä½ç½®
  }
})
```

`scrollBehavior` æ–¹æ³•æ¥æ”¶ `to` å’Œ `from` è·¯ç”±å¯¹è±¡ã€‚ç¬¬ä¸‰ä¸ªå‚æ•° `savedPosition` å½“ä¸”ä»…å½“ `popstate` å¯¼èˆª (é€šè¿‡æµè§ˆå™¨çš„ å‰è¿›/åé€€ æŒ‰é’®è§¦å‘) æ—¶æ‰å¯ç”¨ã€‚

è¯¥å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ª [`ScrollToOptions`](https://developer.mozilla.org/en-US/docs/Web/API/ScrollToOptions) ä½ç½®å¯¹è±¡:

- `{ x: number, y: number }`
- `{ selector: string, offset? : { x: number, y: number }}` (offset åªåœ¨ 2.6.0+ æ”¯æŒ)

å¦‚æœè¿”å›ä¸€ä¸ª falsy (è¯‘è€…æ³¨ï¼šfalsy ä¸æ˜¯ falseï¼Œå‚è€ƒè¿™é‡Œ)çš„å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ä¼šå‘ç”Ÿæ»šåŠ¨ã€‚

```js
scrollBehavior (to, from, savedPosition) {
  return { x: 0, y: 0 }
}
```

å¯¹äºæ‰€æœ‰è·¯ç”±å¯¼èˆªï¼Œç®€å•åœ°è®©é¡µé¢æ»šåŠ¨åˆ°é¡¶éƒ¨ã€‚

è¿”å› `savedPosition`ï¼Œåœ¨æŒ‰ä¸‹ åé€€/å‰è¿› æŒ‰é’®æ—¶ï¼Œå°±ä¼šåƒæµè§ˆå™¨çš„åŸç”Ÿè¡¨ç°é‚£æ ·ï¼š

```js
scrollBehavior (to, from, savedPosition) {
  if (savedPosition) {
    return savedPosition
  } else {
    return { x: 0, y: 0 }
  }
}
```

å¦‚æœä½ è¦æ¨¡æ‹Ÿâ€œæ»šåŠ¨åˆ°é”šç‚¹â€çš„è¡Œä¸ºï¼š

```js
scrollBehavior (to, from, savedPosition) {
  if (to.hash) {
    return {
      selector: to.hash
    }
  }
}
```